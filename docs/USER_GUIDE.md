# Руководство пользователя MADI App

## 1. Доступ и авторизация

- Веб-версия доступна по адресу `http://localhost:8080/` (Docker) или `http://localhost:3000/` (при запуске `server/` + `web` в dev-режиме). Продакшн-домен задаётся переменной `APP_BASE_URL`.
- Для входа используйте корпоративный email. Новые пользователи могут зарегистрироваться самостоятельно, выбрав роль:
  - **Student** — стандартный доступ к чатам, расписанию, сдаче заданий.
  - **Teacher** — дополнительно может создавать чаты, задания, события расписания.
- После регистрации/логина токен сохраняется локально. При закрытии вкладки сессия сохраняется до выхода (`Выйти` в правом верхнем меню).
- Тумблер темы доступен на странице входа и в хедере чатов.

### Тестовые учётные записи

После `npm run reset` в `server/` создаются:

- Преподаватель: `teacher@madi.ru / password`
- Студент: `student@madi.ru / password`

## 2. Главная страница (Auth)

На `/` расположены две формы:

1. **Вход** — email + пароль. После успешной авторизации пользователь перенаправляется в `/chats`.
2. **Регистрация** — имя, email, пароль, роль. После создания аккаунта вход выполняется автоматически.

Ошибки отображаются в виде тултипов (toast) в нижнем углу.

## 3. Чаты (`/chats`)

### Навигация

- Слева — список чатов (групповые и Direct Messages). При клике активируется панель сообщений.
- В верхней панели отображается название активного чата, статус, кнопки: «Видео», «Задания», «Расписание», «Настройки чата» (для владельца/модератора).

### Сообщения

- Поле ввода поддерживает текст, emoji, drag-n-drop файлов (ограничение 100 МБ). Файлы появляются как кликабельные ссылки, скачиваются с `/uploads/…`.
- Редактирование разрешено в течение ~2 минут после отправки, удаление — автору либо владельцу чата.
- Индикация «печатает…» работает для участников, подключённых через Socket.IO.

### Управление участниками

- В роли **owner** или **moderator** доступны действия:
  - Добавление нового участника через поиск email в drawer.
  - Повышение/понижение ролей (owner > moderator > member).
  - Исключение участников.
  - Полное удаление чата (удаляются вложения, задания, сообщения).

### Видеозвонки

- Кнопка «Видео» генерирует ссылку на Jitsi room (`/api/chats/:id/jitsi`). Комната создаётся автоматически и переиспользуется.

## 4. Задания

- В каждом групповом чате доступен drawer «Задания».
- **Teacher/owner/moderator** могут создать задание: название, описание, дедлайн (дата/время).
- Студенты видят список, статусы (open/closed) и дату сдачи. При клике доступны детали.
- Завершённое задание можно закрыть (кнопка «Закрыть»). После закрытия загрузка новых решений блокируется.
- Сдача работы: кнопка «Сдать», загрузка файла (PDF, DOCX и т. п.), комментарий не обязателен.
- Преподаватель видит вкладку «Сдачи» с перечислением студентов и ссылками на файлы.

## 5. Расписание (`/schedule`)

- Страница показывает события из `/api/schedule`.
- Фильтры: группа, курс, дата.
- Преподаватели могут добавлять события напрямую из чата (drawer) или со страницы «Расписание».
- Каждое событие содержит: предмет, аудиторию, тайм-слот, дополнительные заметки.

## 6. Настройки профиля

- В правом верхнем меню (иконка пользователя) доступны:
  - Просмотр имени/email.
  - Кнопка «Обновить данные» (перезапрашивает `/api/me`).
  - «Сменить пароль» (открывает модальное окно; требуется текущий пароль).
  - «Выйти».

## 7. Тестирование и диагностика

- Базовые smoke-тесты UI запускаются командой `npm run test --prefix web`. Они проверяют маршрутизацию и формы аутентификации.
- Для быстрой проверки API можно очистить базу `npm run reset` (в `server/`) и протестировать сценарии с тестовыми аккаунтами.
- Логи сервера пишутся в stdout. Ошибки загрузки файлов отражаются сообщением «Превышен размер файла (100 МБ)».

## 8. Советы по работе

1. **Стабильная сессия** — если UI возвращает на `/`, токен истёк. Нужно войти заново.
2. **Загрузка файлов** — дайте им понятные имена; сервер переименует файл по шаблону `timestamp_originalName`.
3. **Индикатор сети** — если сообщения не отправляются, проверьте подключение Socket.IO (значок молнии в шапке становится красным).
4. **Проблемы с почтой** — при недоступности SMTP письма складываются в `server/data/outbox/*.json`, их можно отправить вручную.
5. **Удаление чата** — это необратимое действие; скачайте важные файлы заранее.

При возникновении ошибок сообщайте администратору, приложив скриншот и время события (из верхней панели чата).
