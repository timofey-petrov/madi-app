Платформа МАДИ — чаты, задания и расписание

Назначение
- Платформа для общения студентов и преподавателей, публикации заданий и ведения расписания.

Основные возможности
- Авторизация по email/паролю, JWT‑сессии. Роли пользователей: студент/преподаватель.
- Чаты
  - Групповые и личные (1‑на‑1). В группах — роли owner/moderator/member.
  - Сообщения: текст, файлы и видео (до 100 МБ), редактирование/удаление.
  - Управление участниками: приглашение по email, назначение/снятие модератора, удаление.
  - Конференции: быстрая ссылка Jitsi для чата.
  - Переименование чата (владелец) и удаление группы (владелец).
- Задания
  - Создание (владелец/модератор/преподаватель — если состоит в чате).
  - Хранится последние 3 задания в каждом чате (старшие удаляются автоматически).
  - Сдача файлов студентами.
- Расписание
  - Преподаватели добавляют события (дата, время начала/окончания), студенты просматривают.
  - Фильтр по группе.
- Интерфейс: светлая/тёмная тема, переключатель сохраняется.

Запуск локально
1) Требуется Node.js 18+.
2) Установите и соберите фронтенд (React):

   cd web
   npm install
   npm run dev  # для разработки

   # Для продакшена
   npm run build

   После `npm run build` бандл попадает в `web/dist`, Express автоматически раздаёт его по `http://localhost:3000/`.
   Если `dist` отсутствует, сервер использует минимальный legacy UI из `server/public`.

3) Запустите API/бекенд:

   cd server
   cp .env.example .env
   npm install
   npm run dev

4) Откройте: `http://localhost:3000/`.

Запуск в Docker
1) Требуется Docker + Docker Compose.
2) В корне репозитория:

   docker compose up -d --build

3) Сервисы:
   - Фронтенд (Nginx + собранный React) — `http://localhost:8080/`.
   - API/бекенд — `http://localhost:3000/` (используется фронтом прокси внутри Nginx).

Внешний доступ (поддомен)
- При наличии Caddy на сервере добавьте в `/etc/caddy/Caddyfile`:

  http://app.madi-app.ru {
    reverse_proxy 127.0.0.1:3000
  }

- Создайте A‑запись `app.madi-app.ru → ваш_IP`. После обновления DNS сайт будет доступен по имени.

Переменные окружения (`server/.env`)
- `PORT` — порт HTTP (по умолчанию 3000).
- `JWT_SECRET` — секрет JWT (обязательно заменить в проде).
- `APP_BASE_URL` — базовый адрес приложения (например, `http://app.madi-app.ru`) — используется в письмах.
- SMTP (опционально): `SMTP_HOST`, `SMTP_PORT`, `SMTP_USER`, `SMTP_PASS`, `SMTP_FROM` — если не заданы, письма пишутся файлами в `server/data/outbox/`.

Роли и доступы
- Пользовательские роли:
  - `teacher` — добавление событий расписания, создание заданий в чатах, где состоит.
  - `student` — просмотр расписания, сдача заданий.
- Роли в чате:
  - `owner` — переименование/удаление чата, назначение модераторов, управление участниками.
  - `moderator` — управление участниками и заданиями чата.
  - `member` — участник.

Страницы
- `/` — вход/регистрация, выбор роли, переключатель темы.
- `/chats` — чаты: список, сообщения, «Участники», «Задания», «Конференция».
- `/schedule` — расписание: добавление (преподаватели) и просмотр (все), фильтр по группе.

Администрирование
- Сброс и загрузка тестовых данных:

   cd server && npm run reset

  Создаются пользователи `teacher@madi.ru/password` и `student@madi.ru/password`, тестовая группа, три задания и событие расписания.

Примечания
- Лимит загрузки — 100 МБ на файл (меняется в `server/index.js`).
- CORS по умолчанию открыт на все источники; для продакшена рекомендуем сузить, например: `app.use(cors({ origin: 'https://app.madi-app.ru' }))`.
